var z=Object.defineProperty,H=Object.defineProperties;var N=Object.getOwnPropertyDescriptors;var f=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,b=Object.prototype.propertyIsEnumerable;var x=(t,e,r)=>e in t?z(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,p=(t,e)=>{for(var r in e||(e={}))L.call(e,r)&&x(t,r,e[r]);if(f)for(var r of f(e))b.call(e,r)&&x(t,r,e[r]);return t},C=(t,e)=>H(t,N(e));var I=(t,e)=>{var r={};for(var o in t)L.call(t,o)&&e.indexOf(o)<0&&(r[o]=t[o]);if(t!=null&&f)for(var o of f(t))e.indexOf(o)<0&&b.call(t,o)&&(r[o]=t[o]);return r};import{c as $,u as T,j as y,G as u,a as s,B as j,r as l,b as B,T as E,C as F,d as M,H as U,R as P,e as m,N as R,f as G,o as K,g as D,h as J,i as Q,S as V}from"./vendor.1e9ca5fa.js";const W=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function r(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerpolicy&&(a.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?a.credentials="include":n.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(n){if(n.ep)return;n.ep=!0;const a=r(n);fetch(n.href,a)}};W();class X{constructor(e){this.baseUrl=e,console.log(`Initialized ApiClient for ${e}`)}async baseRequest(e,r={}){const o=h.getState().token,c=r,{headers:n}=c,a=I(c,["headers"]),i=await fetch(`${this.baseUrl}/${e}`,p({headers:p(C(p({},o&&{Authorization:`Bearer ${o}`}),{"Content-Type":"application/json"}),n)},a));if(i.status===401)throw o!==void 0&&(console.log("Unauthorized, logging out"),h.getState().logOut()),new w;if(i.ok)return await i.json();throw new O(i)}async logIn(e,r){const o=new URLSearchParams({email:e,password:r});try{return await this.baseRequest(`user/login?${o}`,{method:"POST"})}catch(n){throw n instanceof O&&n.response.status===400?new w:n}}}class O extends Error{constructor(e){super();this.response=e}}const Y=new X("https://localhost:7061");class w extends Error{}const k="token",h=$(t=>({token:localStorage[k],isLoggedIn(){return this.token!==void 0},async logIn(e,r){try{const o=await Y.logIn(e,r);return t(n=>({token:o})),!0}catch(o){if(o instanceof w)return!1;throw o}},logOut(){t(e=>({token:void 0}))}}));h.subscribe(t=>{t.token===void 0?localStorage.removeItem(k):localStorage[k]=t.token});function Z(){const t=h(o=>o.logOut),{enqueueSnackbar:e}=T();function r(){t(),e("Logout successful",{variant:"success"})}return y(u,{container:!0,direction:"column",rowSpacing:4,alignItems:"center",justifyContent:"center",style:{minHeight:"100vh"},children:[s(u,{item:!0,children:"Logged in!"}),s(j,{variant:"outlined",onClick:r,children:"Log out"})]})}function _(t){const[e,r]=l.exports.useState(!1),[o,n]=l.exports.useState(void 0),[a,i]=l.exports.useState(void 0),c=l.exports.useRef(!1);return l.exports.useEffect(()=>()=>{c.current=!0},[]),{call:l.exports.useCallback(async(...v)=>{n(void 0),i(void 0),r(!0);try{const d=await t(...v);return c.current||(i(d),r(!1)),d}catch(d){c.current||(n(d),r(!1))}},[t,c]),result:a,loading:e,error:o}}function ee(){const t=B(),e=h(),[r,o]=l.exports.useState(""),[n,a]=l.exports.useState(""),[i,c]=l.exports.useState(void 0),{call:S,loading:v,error:d}=_(e.logIn),{enqueueSnackbar:q}=T();async function A(){const g=await S(r,n);g!==void 0&&(g?q("Login successful",{variant:"success"}):c("wrong credentials"))}return y(u,{container:!0,direction:"column",rowSpacing:4,alignItems:"center",justifyContent:"center",style:{minHeight:"100vh"},children:[s(u,{item:!0,children:s(E,{label:"Email",value:r,error:!!i,helperText:i,onChange:g=>o(g.target.value)})}),s(u,{item:!0,children:s(E,{label:"Password",value:n,type:"password",error:!!i,helperText:i,onChange:g=>a(g.target.value)})}),s(u,{item:!0,children:s(j,{variant:"contained",size:"large",onClick:A,children:"Log in"})}),v&&s(u,{item:!0,children:s(F,{})}),d&&s(u,{item:!0,children:s(M,{color:t.palette.error.main,children:d.toString()})})]})}function te(){const t=h(e=>e.isLoggedIn());return s(U,{children:t?y(P,{children:[s(m,{path:"/",element:s(Z,{})}),s(m,{path:"*",element:s(R,{to:"/",replace:!0})})]}):y(P,{children:[s(m,{path:"/login",element:s(ee,{})}),s(m,{path:"*",element:s(R,{to:"/login",replace:!0})})]})})}const re=G({palette:{primary:{main:K[500]}},components:{MuiTextField:{defaultProps:{variant:"outlined"}}}});D.render(s(J.StrictMode,{children:s(Q,{theme:re,children:s(V,{maxSnack:3,children:s(te,{})})})}),document.getElementById("root"));
