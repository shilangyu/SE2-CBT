var X=Object.defineProperty,Y=Object.defineProperties;var Z=Object.getOwnPropertyDescriptors;var L=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var q=(o,t,r)=>t in o?X(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,P=(o,t)=>{for(var r in t||(t={}))z.call(t,r)&&q(o,r,t[r]);if(L)for(var r of L(t))G.call(t,r)&&q(o,r,t[r]);return o},H=(o,t)=>Y(o,Z(t));var N=(o,t)=>{var r={};for(var s in o)z.call(o,s)&&t.indexOf(s)<0&&(r[s]=o[s]);if(o!=null&&L)for(var s of L(o))t.indexOf(s)<0&&G.call(o,s)&&(r[s]=o[s]);return r};import{c as _,u as j,j as w,G as l,a as n,B as C,r as c,b as $,T as E,L as B,C as K,d as D,H as ee,R as F,e as b,N as M,f as te,o as re,g as oe,h as ne,i as se,S as ae}from"./vendor.d455e525.js";const ie=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const a of e)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function r(e){const a={};return e.integrity&&(a.integrity=e.integrity),e.referrerpolicy&&(a.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?a.credentials="include":e.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(e){if(e.ep)return;e.ep=!0;const a=r(e);fetch(e.href,a)}};ie();class ce{constructor(t){this.baseUrl=t,console.log(`Initialized ApiClient for ${t}`)}async baseRequest(t,r={}){const s=y.getState().token,u=r,{headers:e}=u,a=N(u,["headers"]),i=await fetch(`${this.baseUrl}/${t}`,P({headers:P(H(P({},s&&{Authorization:`Bearer ${s}`}),{"Content-Type":"application/json"}),e)},a));if(i.status===401)throw s!==void 0&&(console.log("Unauthorized, logging out"),y.getState().logOut()),new T;if(i.ok)return await i.json();throw new R(i)}async logIn(t,r){const s=new URLSearchParams({email:t,password:r});try{return await this.baseRequest(`user/login?${s}`,{method:"POST"})}catch(e){throw e instanceof R&&e.response.status===400?new T:e}}async register(t,r,s,e){try{return await this.baseRequest("user",{method:"POST",body:JSON.stringify({email:t,password:r,age:s,gender:e,banned:!1})})}catch(a){throw a instanceof R&&a.response.status===400?new J:a}}}class R extends Error{constructor(t){super();this.response=t}}const U=new ce("https://localhost:7061");class T extends Error{}class J extends Error{}const O="token",y=_((o,t)=>({token:localStorage[O],isLoggedIn(){return t().token!==void 0},async logIn(r,s){try{const e=await U.logIn(r,s);return o(a=>({token:e})),!0}catch(e){if(e instanceof T)return!1;throw e}},async register(r,s,e,a){try{return await U.register(r,s,e,a),await t().logIn(r,s)}catch(i){if(i instanceof J)return!1;throw i}},logOut(){o(r=>({token:void 0}))}}));y.subscribe(o=>{o.token===void 0?localStorage.removeItem(O):localStorage[O]=o.token});function le(){const o=y(s=>s.logOut),{enqueueSnackbar:t}=j();function r(){o(),t("Logout successful",{variant:"success"})}return w(l,{container:!0,direction:"column",rowSpacing:4,alignItems:"center",justifyContent:"center",style:{minHeight:"100vh"},children:[n(l,{item:!0,children:"Logged in!"}),n(C,{variant:"outlined",onClick:r,children:"Log out"})]})}function Q(o){const[t,r]=c.exports.useState(!1),[s,e]=c.exports.useState(void 0),[a,i]=c.exports.useState(void 0),u=c.exports.useRef(!1);return c.exports.useEffect(()=>()=>{u.current=!0},[]),{call:c.exports.useCallback(async(...f)=>{e(void 0),i(void 0),r(!0);try{const h=await o(...f);return u.current||(i(h),r(!1)),h}catch(h){u.current||(e(h),r(!1))}},[o,u]),result:a,loading:t,error:s}}function ue(){const o=$(),t=y(),[r,s]=c.exports.useState(""),[e,a]=c.exports.useState(""),[i,u]=c.exports.useState(void 0),{call:m,loading:f,error:h}=Q(t.logIn),{enqueueSnackbar:v}=j();async function S(){const d=await m(r,e);d!==void 0&&(d?v("Login successful",{variant:"success"}):u("wrong credentials"))}return w(l,{container:!0,direction:"column",rowSpacing:4,alignItems:"center",justifyContent:"center",style:{minHeight:"100vh"},children:[n(l,{item:!0,children:n(E,{label:"Email",value:r,error:!!i,helperText:i,onChange:d=>s(d.target.value)})}),n(l,{item:!0,children:n(E,{label:"Password",value:e,type:"password",error:!!i,helperText:i,onChange:d=>a(d.target.value)})}),w(l,{item:!0,container:!0,direction:"row",justifyContent:"center",gap:4,children:[n(C,{component:B,to:"/register",children:"Create account"}),n(C,{variant:"contained",size:"large",onClick:S,children:"Log in"})]}),f&&n(l,{item:!0,children:n(K,{})}),h&&n(l,{item:!0,children:n(D,{color:o.palette.error.main,children:h.toString()})})]})}function de(){const o=$(),t=y(),{email:r,setEmail:s,password:e,setPassword:a,age:i,setAge:u,gender:m,setGender:f,validate:h,emailError:v,passwordError:S,setEmailError:d,ageError:k,genderError:x}=ge(),{call:I,loading:p,error:A}=Q(t.register),{enqueueSnackbar:V}=j();async function W(){if(h()){const g=await I(r,e,i,m);if(g===void 0)return;g?V("Register successful",{variant:"success"}):d("Email taken")}}return w(l,{container:!0,direction:"column",rowSpacing:4,alignItems:"center",justifyContent:"center",style:{minHeight:"100vh"},children:[n(l,{item:!0,children:n(E,{label:"Email",value:r,error:!!v,helperText:v,onChange:g=>s(g.target.value)})}),n(l,{item:!0,children:n(E,{label:"Password",value:e,type:"password",error:!!S,helperText:S,onChange:g=>a(g.target.value)})}),n(l,{item:!0,children:n(E,{label:"Age",value:i,type:"number",error:!!k,helperText:k,onChange:g=>{g.target.value!==""&&(u(+g.target.value),g.target.value=(+g.target.value).toString())}})}),n(l,{item:!0,children:n(E,{label:"Gender",value:m,error:!!x,helperText:x,onChange:g=>f(g.target.value)})}),w(l,{item:!0,container:!0,direction:"row",justifyContent:"center",gap:4,children:[n(C,{component:B,to:"/login",children:"Log in"}),n(C,{variant:"contained",size:"large",onClick:W,children:"Create account"})]}),p&&n(l,{item:!0,children:n(K,{})}),A&&n(l,{item:!0,children:n(D,{color:o.palette.error.main,children:A.toString()})})]})}function ge(){const[o,t]=c.exports.useState(""),[r,s]=c.exports.useState(""),[e,a]=c.exports.useState(0),[i,u]=c.exports.useState(""),[m,f]=c.exports.useState(void 0),[h,v]=c.exports.useState(void 0),[S,d]=c.exports.useState(void 0),[k,x]=c.exports.useState(void 0);c.exports.useEffect(()=>{f(void 0)},[o]),c.exports.useEffect(()=>{v(void 0)},[r]),c.exports.useEffect(()=>{d(void 0)},[e]),c.exports.useEffect(()=>{x(void 0)},[i]);function I(){let p=!1;return/@/.test(o)||(f("Incorrect email"),p=!0),r.length<8&&(v("Password has to be at least 8 characters"),p=!0),e===void 0?(d("Age is required"),p=!0):e!==Math.floor(e)?(d("Age has to be an integer"),p=!0):(e<=0||e>=150)&&(d("Please provide valid age"),p=!0),i.length===0&&(x("Please specify gender"),p=!0),!p}return{email:o,setEmail:t,password:r,setPassword:s,age:e,setAge:a,gender:i,setGender:u,validate:I,emailError:m,setEmailError:f,passwordError:h,ageError:S,genderError:k}}function he(){const o=y(t=>t.isLoggedIn());return n(ee,{children:o?w(F,{children:[n(b,{path:"/",element:n(le,{})}),n(b,{path:"*",element:n(M,{to:"/",replace:!0})})]}):w(F,{children:[n(b,{path:"/login",element:n(ue,{})}),n(b,{path:"/register",element:n(de,{})}),n(b,{path:"*",element:n(M,{to:"/login",replace:!0})})]})})}const fe=te({palette:{primary:{main:re[500]}},components:{MuiTextField:{defaultProps:{variant:"outlined"}}}});oe.render(n(ne.StrictMode,{children:n(se,{theme:fe,children:n(ae,{maxSnack:3,children:n(he,{})})})}),document.getElementById("root"));
